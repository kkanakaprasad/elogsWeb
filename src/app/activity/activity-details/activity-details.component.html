<button (click)="navigateToPreviousRoute()"><mat-icon>keyboard_return</mat-icon></button>
<div class="row container">
  <div class="row">
    <div class="col-md-9">
      <h2>{{activityData?.title | titlecase}}</h2>
      <p>
        Last updated on {{ activityData?.createdAt | date : "medium" }}
        <span *ngIf="activityData?.activityLog.length >= 1"><mat-icon> chat</mat-icon>{{
          activityData?.activityLog.length }}</span>
      </p>
      <hr />
      <div class="row">
        <div class="col-md-3">
          <table class="table table-borderless">
            <tbody>
              <tr>
                <td>Type</td>
                <td>{{ activityType }}</td>
              </tr>
              <tr>
                <td>Entry Type:</td>
                <td>{{ activityEntryType }}</td>
              </tr>
              <tr>
                <td>Related To:</td>
                <td>{{ activityRelatedTypesData }}</td>
              </tr>
              <tr>
                <td>Priority:</td>
                <td [class]="statusClass(activityData?.priority)">{{ activityData?.priority | titlecase }}</td>
              </tr>
              <tr>
                <td>Status:</td>
                <td>{{ activityData?.status | titlecase }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-3">
          <table class="table table-borderless">
            <tbody>
              <tr>
                <td>Reported By:</td>
                <td>{{ activityReportedBy }}</td>
              </tr>
              <tr>
                <td>Ministry/Department:</td>

                <!-- <td>
                  <p *ngFor="let ministry of organizationsInvolved">{{ ministry.organization }}</p>
                  </td> -->
                <td>
                  {{ ministryName }}
                </td>
              </tr>
              <tr>
                <td>Organization:</td>
                <td>{{ organizationCreatedBy }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="col-md-3">
          <table class="table table-borderless">
            <tbody>
              <tr>
                <td>Sector:</td>
                <td>{{ activitySectorsData }}</td>
              </tr>
              <tr>
                <td>Scope:</td>
                <td>{{ ActivityScopeData }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div>
          <div class="col-md-12 my-2">
            <mat-card>
              <mat-card-content>
                <div class="d-flex">
                  <div class="img-span d-flex">
                    <mat-icon class="mat-i">person_outline</mat-icon>
                  </div>
                  <div>
                    Created by <strong>{{ activityReportedBy }}</strong>
                    <p>{{ activityData?.createdAt | date : "medium" }}</p>
                  </div>
                </div>
                <hr />
                <div [innerHTML]="activityData?.description"></div>
                <div class="d-flex">
                  <mat-icon *ngIf="activityData?.attachments?.length>=1">attach_file</mat-icon>
                  <p *ngFor="let attachments of activityData?.attachments">
                    <mat-icon>insert_drive_file</mat-icon>{{ attachments?.name }} {{ attachments?.size/1024 |
                    number:'.2-2' }} Kb
                  </p>
                </div>
              </mat-card-content>
            </mat-card>
          </div>

          <div class="col-md-12 my-2" *ngFor="let activity of activityLogData;let i = index">
            <mat-card>
              <mat-card-content>
                <div class="d-flex justify-content-between">
                  <div>{{i+1}}</div>
                  <div class="img-span d-flex">
                    <mat-icon class="mat-i">person_outline</mat-icon>
                  </div>
                  <div>
                    Created by {{activity.createdByUserName}}
                    <p>{{ activity.updatedAt | date : "medium" }}</p>
                  </div>
                  <span class="organization-title"><strong>{{ activity.title | titlecase }}</strong></span>
                  <div>
                    <p>Status: {{activity.status| titlecase}}</p>

                  </div>
                  <div>
                    <p>Assigned To: {{ selectedActivityAssignedTo }} </p>
                  </div>
                </div>
                <hr />
                <div [innerHTML]="activity.message"></div>
                <div class="d-flex">
                  <mat-icon *ngIf="activity?.attachments?.length>=1">attach_file</mat-icon>

                  <div *ngFor="let attachment of activity?.attachments">
                    <mat-icon>insert_drive_file</mat-icon>{{ attachment?.name }} {{ attachment?.size/1024 |
                    number:'.2-2' }} Kb
                  </div>
                </div>

              </mat-card-content>
            </mat-card>
          </div>
          <form [formGroup]="activityLogForm" (ngSubmit)="onSubmit()">
            <div>
              <label> Write your Reply: </label>
              <app-rich-text-editor value="" (updatedDescription)="updatedDescription($event)"></app-rich-text-editor>
            </div>
            <mat-form-field appearance="outline">
              <mat-label>Status: </mat-label>
              <mat-select formControlName="status">
                <mat-option [value]="status[0]">New</mat-option>
                <mat-option [value]="status[1]">In Progress</mat-option>
                <mat-option [value]="status[2]">Not Admissible</mat-option>
                <mat-option [value]="status[4]">Resolved</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-radio-group aria-label formControlName="priority" layout="row">
              <div class="row mb-3">
                <mat-label class="col-sm-3 col-form-label">Priority:</mat-label>
                <div class="col-sm-8">
                  <mat-radio-button [value]="Priority[0]">None</mat-radio-button>
                  <mat-radio-button [value]="Priority[1]">Low</mat-radio-button>
                  <mat-radio-button [value]="Priority[2]">Medium</mat-radio-button>
                  <mat-radio-button [value]="Priority[3]">High</mat-radio-button>
                </div>
              </div>
            </mat-radio-group>
            <mat-radio-group aria-label formControlName="visibility" layout="row">
              <div class="row mb-3">
                <mat-label class="col-sm-3 col-form-label">Visibility:</mat-label>
                <div class="col-sm-8">
                  <mat-radio-button [value]="visibility[0]">Internal</mat-radio-button>
                  <mat-radio-button [value]="visibility[1]">Everyone</mat-radio-button>
                </div>
              </div>
            </mat-radio-group>

            <mat-form-field appearance="outline">
              <mat-label>Assign to</mat-label>
              <mat-select formControlName="assignTo">
                <mat-option *ngFor="let Organization of organizationList" [value]="Organization._id">
                  {{ Organization.organization }}</mat-option>
              </mat-select>
            </mat-form-field>
            <div>
              <app-fileuploader (updatedFilesDescription)="updatedFilesDescription($event)"></app-fileuploader>
            </div>

            <div class="d-flex justify-content-end align-items-center">
              <button type='button' (click)="resetActivityLogForm()" mat-raised-button>Cancel</button>
              <button mat-raised-button color="primary" type="submit" [disabled]="description === '' ">
                Post
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-3 kit">
      <ng-container *ngIf="isSuperAdmin">
        <div class="d-flex justify-content-start">
          <button mat-stroked-button class="padding" (click)="refreshPage()" matTooltip="Reload">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-stroked-button class="padding" (click)="updateActivityDetails()" matTooltip="Edit"
            *ngIf="this.activityData?.status === 'NEW'">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-stroked-button class="padding" (click)="updateSelectedArchiveStatus()" matTooltip="Archive">
            <mat-icon>archive</mat-icon>
          </button>
          <button mat-stroked-button class="padding" (click)="deleteSelectedActivity()" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
          <button mat-stroked-button class="padding" *ngIf="
              this.activityData?.status === 'NEW' ||
              this.activityData?.status === 'INPROGRESS'
            " (click)="updateStatusOfSelectedActivity('Resolve')" matTooltip="Resolve">
            <mat-icon>assistant_photo</mat-icon>
          </button>
          <button mat-stroked-button class="padding" *ngIf="this.activityData?.status === 'REJECTED' ? false : true"
            (click)="updateStatusOfSelectedActivity('Reject')" matTooltip="Reject">
            <mat-icon>checkmark</mat-icon>
          </button>
          <button mat-stroked-button class="padding" (click)="downloadActivity()" matTooltip="Download">
            <mat-icon>download</mat-icon>
          </button>
        </div>
      </ng-container>
      <ng-container *ngIf="logedInUserId == selectedActivityCreatedById">
        <div class="d-flex justify-content-start">
          <button mat-stroked-button class="padding" (click)="refreshPage()" matTooltip="Refresh">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-stroked-button class="padding" *ngIf="
              this.activityData?.status === 'NEW' ||
              this.activityData?.status === 'INPROGRESS' ||
              this.activityData?.status === 'REJECTED'
            " (click)="updateSelectedArchiveStatus()" matTooltip="Archive">
            <mat-icon>archive</mat-icon>
          </button>
          <button mat-stroked-button class="padding" *ngIf="
              this.activityData?.status === 'NEW' ||
              this.activityData?.status === 'REJECTED'
            " (click)="deleteSelectedActivity()" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
          <button mat-stroked-button class="padding" (click)="downloadActivity()" matTooltip="Download">
            <mat-icon>download</mat-icon>
          </button>
        </div>
      </ng-container>

      <ng-container *ngIf="
          isAssignee &&
          activityData?.createdByOrganization !=
            activityData?.organizationData[0]._id && isSuperAdmin">
        <div class="d-flex justify-content-start">
          <button mat-stroked-button class="padding" (click)="refreshPage()" matTooltip="Reload">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-stroked-button class="padding" (click)="downloadActivity()" matTooltip="Download">
            <mat-icon>download</mat-icon>
          </button>
        </div>
      </ng-container>

      <hr />
      <div class="d-flex align-items-center">
        <mat-icon class="mat-Icon">folder_shared</mat-icon>
        <h3 class="quick-action" data-toggle="dropdown">Assigned To</h3>
      </div>
      <div class="d-flex">
        <div class="img-span">
          <mat-icon class="mat-i">person_outline</mat-icon>
        </div>
        <strong> {{ selectedActivityAssignedTo }}</strong>
      </div>
      <hr />
      <div class="d-flex">
        <div class="d-flex">
          <mat-icon> date_range</mat-icon>
          <h4>{{ !activityData?.dueDate ? "No DueDate" : activityData?.dueDate | date : "medium" }}</h4>
          <button mat-button [matMenuTriggerFor]="dueDateFiltersMatMenu" class="date-icon">
            <mat-icon>edit</mat-icon>
            <mat-menu #menu="matMenu">
              <button mat-menu-item>
                Due Date {{ activityData?.dueDate | date : "medium" }}
              </button>
              <button mat-menu-item>Updated by{{activityData?.updatedBy}}</button>
              <button mat-menu-item>
                Created At {{ activityData?.createdAt | date : "medium" }}
              </button>
            </mat-menu>
          </button>
          <button mat-button [matMenuTriggerFor]="menu" class="date-icon">
            <mat-icon>view_headline</mat-icon>
          </button>
        </div>
        <mat-menu #dueDateFiltersMatMenu="matMenu">
          <button mat-menu-item (click)="dueDateSetter('noDueDate')">
            No Due Date
          </button>

          <button mat-menu-item (click)="dueDateSetter('Today')">Today</button>
          <button mat-menu-item (click)="dueDateSetter('Tomorrow')">
            Tomorrow
          </button>
          <button mat-menu-item (click)="dueDateSetter('Next Monday')">
            Next Monday
          </button>
          <button mat-menu-item (click)="dueDateSetter('This Friday')">
            This Friday
          </button>

          <mat-label>Choose a date</mat-label>
          <input matInput [matDatepicker]="picker" (dateChange)="dueDateSetter('custom', $event)" />
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-menu>
      </div>
      <hr />
      <div class="d-flex flex-wrap">
        <mat-icon>attach_file</mat-icon>
        <h3 class="mx-2 text">
          {{
          activityData?.attachments?.length == 0
          ? "No Files in this Activity"
          : "Files in this Activity"
          }}
        </h3>
        <div *ngFor="let fileData of activityData?.attachments">
          <mat-icon>insert_drive_file</mat-icon>{{ fileData?.name
          }} {{fileData?.size /1024 | number:'.2-2'}} Kb {{ fileData?.updatedAt | date : "medium" }}
        </div>
      </div>
      <hr />
      <div class="d-flex">
        <mat-icon>timeline</mat-icon>
        <h3 class="mx-3">Activities</h3>
      </div>
      <div>
        <div>
          <strong>Created:</strong>
          {{ this.activityData?.createdAt | date : "medium" }}
        </div>
        <div class="my-2" *ngFor="let activityLog of ActivityTimeLogs">
          <p>
            <strong>{{ activityLog.status }}:</strong>
            {{ activityLog.updatedAt | date : "medium" }}
          </p>
        </div>
      </div>
      <hr />
      <div class="d-flex">
        <mat-icon> people</mat-icon>
        <h3 class="mx-3">People Involved</h3>
      </div>
      <div class=" d-flex" *ngFor="let ministry of organizationsInvolved">
        <span class="img-span d-flex align-items-center justify-content-center">
          <mat-icon class="mat-i" matTooltip="{{ ministry.organization }}">person_outline</mat-icon>
        </span>
      </div>
    </div>
  </div>
</div>